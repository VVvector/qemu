@startuml

box guest os
participant e1000_driver as A
end box

box qemu
participant e1000_device as B
participant qemu_net as C
participant qemu_queue as D
participant qemu_tap as E
end box

box host os
participant tap_net_device as F
end box

F->E: write data to TAP and wakeup qemu iothread

E->E: tap_send
activate E
    E->C: qemu_send_packet_async
deactivate E

activate C
    C->D: qemu_net_queue_send
deactivate C

activate D
    D->C: qemu_deliver_packet_iov
    note right
    queue->deliver callback is set qemu_deliver_packet_iov
    to in qemu_net_client_setup()
    end note
deactivate D

activate C
    C->B: e1000_receive_iov
    note right
    nc->info->receive_iov callback is set in pci_e1000_realize;
    in net_e1000_info
    end note
deactivate C

activate B
    B->A: set_interrupt_cause, VM Entry
deactivate B

@enduml